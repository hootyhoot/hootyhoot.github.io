<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> dockerising METARbot | Mikhail Armanuel </title> <meta name="author" content="Mikhail Armanuel"> <meta name="description" content="rebuilding METARbot to be hosted in a container"> <meta name="keywords" content="academic-website, portfolio-website, computer-science, nottingham, nottingham-university, cv, UNM, Web-Development, Mobile-App-Development, Data-Structures, Algorithms, Object-Oriented-Programming, Java, Python, C++, JavaScript, React, Angular, Node.js, Machine-Learning, Artificial-Intelligence, Data-Analysis,D atabase-Management, SQL, NoSQL, Cloud-Computing, DevOps, Agile-Methodology, Git, GitHub, Open-Source, Hackathons, Coding-Projects, Portfolio, Computer-Science-Student,kuala-lumpur-Computer-Science, malaysia-computer-science, nottingham-Computer-Science, malaysia-student"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.png?f02556619ab2087c71f8c547cac47d66"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://mikhail.codes/projects/dockerising/"> <script src="/assets/js/theme.js?a5ca4084d3b81624bcfa01156dae2b8e"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Mikhail</span> Armanuel </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">dockerising METARbot</h1> <p class="post-description">rebuilding METARbot to be hosted in a container</p> </header> <article> <p>This discord bot is being used in over 75 aviation servers and can be invited to your server using this <a href="https://discord.com/oauth2/authorize?client_id=929045807842361404&amp;permissions=3072&amp;scope=bot" target="_blank" rel="external nofollow noopener">link</a>! A demo can be found at the bottom of this page.</p> <hr> <p>I havenâ€™t touched METARbot in more than a year now but I recently got a notification that my previous hoster â€˜repl.itâ€™ is discontinuing all their free hosting products. And so, I had to figure whether to move hosts, or privately host.</p> <h4>To migrate or to stay? That is the question.</h4> <p>The biggest choices online were either vercel.app, fly.io, repl.itâ€™s paid plan, or AWS. Both vercel and fly donâ€™t support constant listening applications like bots so they were out of the question. Repl.itâ€™s paid deployments reserved VM plan was $7 a month, which was way too much to host just 1 or 2 bots. AWS required setup comparable to just using docker on a VM. So in the end I decided on just going the hard but cheap way and renting a VPS, for less than a dollar a month on racknerdâ€™s 1GB KVM VPS I get full root access to a VM I can easily SSH into.</p> <p>Thankfully, I wrote METARbot using Flask which needed exactly 0 changes to the actual python. So the only things that need to be done are preparing it to be built into an image. First we need the Dockerfile which looks like this:</p> <div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># syntax=docker/dockerfile:1</span>

<span class="k">FROM</span><span class="s"> python:3.8-slim-buster</span>

<span class="k">WORKDIR</span><span class="s"> /metarbot</span>

<span class="k">COPY</span><span class="s"> requirements.txt requirements.txt</span>
<span class="k">RUN </span>pip3 <span class="nb">install</span> <span class="nt">-r</span> requirements.txt

<span class="k">COPY</span><span class="s"> . .</span>

<span class="k">CMD</span><span class="s"> [ "python3", "./api/main.py"]</span>
</code></pre></div></div> <p>Itâ€™s important to note that Docker doesnâ€™t work inside your directory but rather in a working directory fully contained inside the Docker container, in this case called <strong>/metarbot</strong></p> <p>Then we can create the requirements file which lists out the libraries needed for runtime using the command:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip3 freeze <span class="o">&gt;</span> requirements.txt
</code></pre></div></div> <p>Now with the prep work done we can build the image. The beauty of Docker is that you can build the image on any Docker supported architecture and export it to any other and have it work, but for convenience sake we will build inside the VM that will run it. So, I cloned my work there and ran:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build METARbot/ <span class="nt">--tag</span> metarbot
</code></pre></div></div> <p>This builds a Docker image under the tag <strong>metarbot</strong> so that itâ€™s easier to identify later.</p> <p>Finally to run we simply type:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-d</span> <span class="nt">--restart</span> unless-stopped metarbot
</code></pre></div></div> <p>This command runs the container in a detached mode which runs in the background, and always attempts to restart in case of failure unless we purposely stop it.</p> <hr> <p>Now letâ€™s demo the bot!</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/dockerising1-480.webp 480w,/assets/img/dockerising1-800.webp 800w,/assets/img/dockerising1-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/dockerising1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="metar bot trial for KLIA airport" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption"> What's the weather like in KLIA maybe? </div> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/dockerising2-480.webp 480w,/assets/img/dockerising2-800.webp 800w,/assets/img/dockerising2-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/dockerising2.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="metar bot trial for Changi airport" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption"> How about Singapore Changi? </div> </div> </div> <div class="caption"> <h1>ðŸ¤”ðŸ¤”ðŸ¤”</h1> <h4>But what do the numbers mean?!</h4> </div> <p>Well, letâ€™s try to parse the WMKK example;</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WMKK 170600Z VRB05KT 9999 SCT018 32/25 Q1008 NOSIG
</code></pre></div></div> <ul> <li> <strong>WMKK 170600Z</strong> indicates the ICAO code of KLIA; WMKK, and 170600Z tells us the UTC time and day that the report was made on (17th, 6am UTC time). </li> <li> <strong>VRB05KT 9999</strong> indicates that the wind direction was variable (changing) and blowing at 5 knots, and 9999 means that the visibility was more or equal to 9999 meters. </li> <li> <strong>SCT018 32/25</strong> indicates that there are scattered clouds at 1800 feet and 32/25 means that the temperature was 32C and dewpoint temperature was 25C. </li> <li> <strong>Q1008 NOSIG</strong> indicates that the air pressure was 1008 millibars, and NOSIG means no significant weather changes are expected. </li> </ul> <p>This system is what real pilots and flightsimmers like me use to plan flights and decide whether it is safe to land or takeoff from an airport. And I hope this bot helps a few people in doing just that! I also plan to add a few more features to the bot later on like automatic parsing into plain english.</p> </article> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> Â© Copyright 2024 Mikhail Armanuel. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?b7816bd189846d29eded8745f9c4cf77"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>